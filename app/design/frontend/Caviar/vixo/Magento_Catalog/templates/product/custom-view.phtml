<?php
$product = $block->getProduct(); 
$formKey = $block->getFormKey();
$galleryImages = $product->getMediaGalleryImages();

// dd($product->getFinalPrice());die;
?>

<section class="single_product-page">
        <div class="product-page">
            <div class="row">
                <!-- Left Section -->
                <?php
/** @var \Magento\Catalog\Model\Product $product */
$product = $_product ?? $block->getProduct();
$galleryImages = $product->getMediaGalleryImages();
?>

<div class="col-lg-6 d-flex">
                    <!-- Thumbnails -->
                    <div class="swiper thumbs-swiper order-lg-1 order-2 swiper-vertical swiper-thumbs">
                        <div class="swiper-wrapper">
                            <?php if ($galleryImages && $galleryImages->getSize()): ?>
                                <?php $i = 0; foreach ($galleryImages as $image): ?>
                                    <div class="swiper-slide <?= $i === 0 ? 'swiper-slide-active' : '' ?>" style="height: 92px; margin-bottom: 10px;">
                                        <img src="<?= $image->getUrl() ?>"
                                            alt="<?= $block->escapeHtml($image->getLabel()) ?>"
                                            class="img-fluid" />
                                    </div>
                                <?php $i++; endforeach; ?>
                            <?php else: ?>
                                <!-- Fallback placeholder -->
                                <div class="swiper-slide" style="height: 92px; margin-bottom: 10px;">
                                    <img src="<?= $block->getViewFileUrl('Magento_Catalog::images/product/placeholder/image.jpg') ?>" alt="Placeholder" />
                                </div>
                            <?php endif; ?>
                        </div>
                    </div>

                    <!-- Main Swiper -->
                    <div class="swiper main-swiper flex-grow-1 order-lg-2 order-1">
                        <div class="swiper-wrapper">
                            <?php if ($galleryImages && $galleryImages->getSize()): ?>
                                <?php foreach ($galleryImages as $image): ?>
                                    <div class="swiper-slide">
                                        <img src="<?= $image->getUrl() ?>"
                                            alt="<?= $block->escapeHtml($image->getLabel()) ?>"
                                            class="img-fluid" />
                                    </div>
                                <?php endforeach; ?>
                            <?php else: ?>
                                <div class="swiper-slide">
                                    <img src="<?= $block->getViewFileUrl('Magento_Catalog::images/product/placeholder/image.jpg') ?>" alt="Placeholder" />
                                </div>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>


                <!-- Right Section -->
                <div class="col-lg-6 single-product-details">
                    <div class="product-heading d-flex justify-content-between align-items-center">
                        <h2><?= $product->getName(); ?></h2>
                        <div class="rating">4.2 (1653) 
                            <img class="star-img" src="./images/wishlist/star.png" alt="">
                            <img class="star-img" src="./images/wishlist/star.png" alt="">
                            <img class="star-img" src="./images/wishlist/star.png" alt="">
                            <img class="star-img" src="./images/wishlist/star.png" alt="">
                        </div>
                    </div>
                    <div class="single-product-price">₹<?= number_format($product->getFinalPrice(), 2); ?></div>
                    <p>Options</p>
                    <div class="options-box">
                        <button class="option-btn active">Z5 Body Only</button>
                        <button class="option-btn">24–50mm Lens Kit</button>
                    </div>

                    <div class="stock"><img src="<?= $block->getViewFileUrl('./images/product-single/InStock.png') ?>" alt=""> Currently in Stock</div>

                    <ul class="specs">
                        <li><img src="<?= $block->getViewFileUrl('./images/product-single/Chip.png'); ?>" alt=""> Expeed 6 Chip</li>
                        <li><img src="<?= $block->getViewFileUrl('./images/product-single/Lens.png');?>" alt=""> Works with 24–50mm Lens</li>
                        <li><img src="<?= $block->getViewFileUrl('./images/product-single/megapixels 1.png'); ?>" alt=""> 24.3 Million Effective Pixels
                        </li>
                        <li><img src="<?= $block->getViewFileUrl('./images/product-single/Battery.png'); ?>" alt=""> EN-EL15c rechargeable Li-ion battery
                        </li>
                        <li><a href="#" class="single-product-link ">View All Tech Specs</a></li>
                    </ul>

                    <!-- <a href="#" class="text-decoration-none fw-semibold d-block mb-3">View All Tech Specs</a> -->

                    <div class="quantity-box">
                        <span id="qty" class="quantity-number">1</span>
                        <button class="quantity-btn" onclick="decreaseQty()">-</button>
                        <button class="quantity-btn" onclick="increaseQty()">+</button>
                    </div>

                    <div class="button-group d-flex mb-3">
<button class="btn add-to-cart"
        type="button"
        data-post='<?= /* JSON encode for safety */ $block->escapeHtml(
            json_encode([
                'action' => $block->getAddToCartUrl($product),
                'data'   => [
                    'product'  => $product->getId(),
                    'form_key' => $formKey
                ]
            ])
        ); ?>'>
        Add To Cart
    </button>
                            <button class="btn buy-now">Buy It Now</button>
                        <button class="btn bulk-order">Bulk Order</button>
                    </div>

                    <div class="info-text">
                        <p>
                            <img src="<?= $block->getViewFileUrl('./images/product-single/Help.png'); ?>" alt="">
                            <!-- <i class="fa-regular fa-message"></i> -->
                            Got any questions? <a href="/contact-us">Contact us</a>
                        </p>
                        <p>
                            <img src="<?= $block->getViewFileUrl('./images/product-single/Frame.png'); ?>" alt="">
                            <!-- <i class="fa-solid fa-truck"></i>  -->
                            Free Shipping over ₹700
                        </p>
                        <p>
                            <img src="<?= $block->getViewFileUrl('./images/product-single/Frame (1).png'); ?>" alt="">
                            <!-- <i class="fa-solid fa-share-nodes"></i> -->
                            Share
                        </p>
                    </div>
                </div>
            </div>

            <!-- Accordion Section -->
            <div class="row">
                <div class="col-lg-6">
                    <div class="accordion product-single-accordion" id="productAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="descHeading">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#descCollapse" aria-expanded="false">
                                    Description
                                </button>
                            </h2>
                            <div id="descCollapse" class="accordion-collapse collapse" data-bs-parent="#productAccordion" style="">
                                <div class="accordion-body">
                                    Your full frame journey begins with the Z 5. Simple yet sophisticated, compact yet
                                    powerful, the Z 5 is built to grow with you. It’s everything you’d expect from a
                                    full frame mirrorless camera—intense detail, expansive views, brilliant low light
                                    capabilities, 4K UHD video and more—plus all the innovative tools you need to push
                                    the limits of your creativity.

                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header" id="techHeading">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#techCollapse" aria-expanded="true">
                                    Tech Specs
                                </button>
                            </h2>
                            <div id="techCollapse" class="accordion-collapse collapse show" data-bs-parent="#productAccordion" style="">
                                <div class="accordion-body">
                                    Sensor: Full-frame CMOS | Processor: Expeed 6 | Battery: EN-EL15c | Display: 3.2”
                                    Tilting LCD
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item border-b">
                            <h2 class="accordion-header" id="shippingHeading">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#shippingCollapse" aria-expanded="false">
                                    Shipping &amp; Warranty
                                </button>
                            </h2>
                            <div id="shippingCollapse" class="accordion-collapse collapse" data-bs-parent="#productAccordion" style="">
                                <div class="accordion-body">
                                    Free shipping on orders above ₹700. 1-year manufacturer warranty included.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="long-bar-section">
        <!-- Promo Bar -->
        <div class="promo-bar">
            <div class="promo-text">
                <span>USE CODE FRIDAY50 FOR 50% OFF</span>
                <span>USE CODE FRIDAY50 FOR 50% OFF</span>
                <span>USE CODE FRIDAY50 FOR 50% OFF</span>
                <span>USE CODE FRIDAY50 FOR 50% OFF</span>
                <span>USE CODE FRIDAY50 FOR 50% OFF</span>
            </div>
        </div>
    </section>

    <section class="specs-details">
        <div class="">
            <!-- Section Title -->
            <h2 class="section-title">What's included</h2>

            <!-- 4 Icon Row -->
            <div class="row justify-content-center text-center mb-5">
                <div class="col-6 col-md-3 icon-box">
                    <img src="<?= $block->getViewFileUrl('./images/product-single/DSLR.png'); ?>" alt="Nikon Z5">
                    <p class="icon-name">Nikon Z5</p>
                </div>
                <div class="col-6 col-md-3 icon-box">
                    <img src="<?= $block->getViewFileUrl('./images/product-single/Lens (1).png'); ?>" alt="Lens">
                    <p class="icon-name">20mm Lens</p>
                </div>
                <div class="col-6 col-md-3 icon-box">
                    <img src="<?= $block->getViewFileUrl('./images/product-single/Charger.png'); ?>" alt="Cable">
                    <p class="icon-name">Charging Cable</p>
                </div>
                <div class="col-6 col-md-3 icon-box">
                    <img src="<?= $block->getViewFileUrl('./images/product-single/ST.png'); ?>" alt="Adobe Subscription">
                    <p class="icon-name">Adobe Stock Subscription</p>
                </div>
            </div>

            <!-- Orange Info Block -->
            <div class="info-block">
                <div class="row text-content">
                    <div class="col-lg-6">
                        <div class="side-text">
                            <h3>Expand your creative playground</h3>
                            <p>
                                Your full frame journey begins with the Z 5. Simple yet sophisticated, compact yet
                                powerful, the Z 5 is built to grow with you. It’s everything you’d expect from a full
                                frame mirrorless camera—intense detail, expansive views, brilliant low light
                                capabilities, 4K UHD video and more—plus all the innovative tools you need to push the
                                limits of your creativity.

                            </p>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <img class="side-image" src="<?= $block->getViewFileUrl('./images/product-single/Image (1).png'); ?>" alt="Camera">

                    </div>

                </div>
            </div>

            <!-- 3-Column Features -->
            <div class="row text-center">
                <div class="col-md-4 feature-box p-2">
                    <img src="<?= $block->getViewFileUrl('./images/product-single/Chip (1).png'); ?>" alt="Super powered">
                    <h5>Super powered.</h5>
                    <p>
                        Powered by Nikon’s EXPEED 6 image processor, the Z 5 delivers stunning image quality with
                        enhanced sharpness,
                        clarity, and detail.
                    </p>
                </div>
                <div class="col-md-4 feature-box p-2">
                    <img src="<?= $block->getViewFileUrl('./images/product-single/Sutter Speed.png'); ?>" alt="Stability">
                    <h5>The stability you crave.</h5>
                    <p>
                        With 5-axis in-body image stabilization, you can shoot handheld and still achieve crystal-clear
                        photos and videos,
                        even in low light.
                    </p>
                </div>
                <div class="col-md-4 feature-box p-2">
                    <img src="<?= $block->getViewFileUrl('./images/product-single/Stability.png'); ?>" alt="Speed">
                    <h5>In the blink of an iris.</h5>
                    <p>
                        Experience blazing-fast autofocus performance that captures subjects instantly, whether you’re
                        shooting portraits or motion.
                    </p>
                </div>
            </div>
        </div>
    </section>
<?php
echo $block->getLayout()
    ->createBlock(\Magento\Review\Block\Product\View\ListView::class)
    ->setTemplate('Magento_Catalog::product/custom-review.phtml')
    ->toHtml();
?>
    <section class="camera-out-section position-relative">
        <div class="help-section">
            <div class="help-text">
                <h2>Got a question? We are here to help</h2>
                <p>If you don’t find an answer in our FAQ page, please contact us below, our customer support is
                    available Monday to Friday: 9am- 5pm.</p>
                <div class="team-avatars">
                    <img src="<?= $block->getViewFileUrl('./images/product-single/big-review.jpg'); ?>" alt="">
                    <img src="<?= $block->getViewFileUrl('./images/product-single/big-review.jpg'); ?>" alt="">
                    <img src="<?= $block->getViewFileUrl('./images/product-single/big-review.jpg'); ?>" alt="">
                </div>
                <div class="contact-btn">
                    <button class="btn">Contact us</button>
                    <small>You’ll get a response within 24 hours</small>
                </div>
            </div>
            <img src="<?= $block->getViewFileUrl('./images/product-single/big-camera.png'); ?>" alt="Camera" class="help-image">
        </div>
    </section>

    <section class="full-image-section real-world" style="background: url('https://caviar-development.netlify.app/images/product-single/full-image.jpg');background-size: cover;background-repeat: no-repeat;">
        <h2>Built for the real world.</h2>
    </section>
<script>
    require(['jquery', 'mage/dataPost'], function($) {
    $(document).ready(function () {
        // Attach Magento dataPost to our custom Add to Cart button
        $('.add-to-cart').mage('dataPost');

        // Optional: show quick feedback
        $('.add-to-cart').on('click', function() {
            let $btn = $(this);
            $btn.text('Adding...').prop('disabled', true);

            // Wait a bit, then revert (Magento reloads minicart automatically)
            setTimeout(() => {
                $btn.text('Add To Cart').prop('disabled', false);
            }, 1500);
        });
    });
});
require([
    'jquery',
    'swiper' // Make sure Swiper is available (add path if custom)
], function ($, Swiper) {
    'use strict';

    $(document).ready(function () {

        // Thumbnail Swiper
        var thumbSwiper = new Swiper('.thumbs-swiper', {
            direction: 'vertical',
            spaceBetween: 10,
            slidesPerView: 4,
            watchSlidesProgress: true,
            watchSlidesVisibility: true,
            freeMode: true,
            breakpoints: {
                0: {
                    direction: 'horizontal', // horizontal on mobile
                    slidesPerView: 3,
                },
                768: {
                    direction: 'vertical', // vertical on desktop
                    slidesPerView: 4,
                }
            }
        });

        // Main Swiper
        var mainSwiper = new Swiper('.main-swiper', {
            spaceBetween: 10,
            slidesPerView: 1,
            loop: true,
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev'
            },
            thumbs: {
                swiper: thumbSwiper
            },
            autoplay: {
                delay: 4000,
                disableOnInteraction: false,
            },
            speed: 600,
        });
$('.accordion-button').on('click', function() {
            const target = $(this).data('bs-target');
            const $target = $(target);

            // Collapse others
            $('.accordion-collapse').not($target).slideUp().removeClass('show');
            $('.accordion-button').not(this).addClass('collapsed');

            // Toggle current
            $target.slideToggle().toggleClass('show');
            $(this).toggleClass('collapsed');
        });
    });
});
</script>
